var bookInvoice=()=>{class l{constructor(){this["template-1"]=document.querySelector("book-invoice #template-1"),this["template-2"]=document.querySelector("book-invoice #template-2"),this.templates=document.querySelectorAll("book-invoice [name='templates']"),this["book-author"]=document.querySelector("book-invoice #book-author"),this["bs-name"]=document.querySelector("book-invoice #bs-name"),this["store-address"]=document.querySelector("book-invoice #store-address"),this["name-book"]=document.querySelector("book-invoice #name-book"),this.publisher=document.querySelector("book-invoice #publisher"),this.description=document.querySelector("book-invoice #description"),this.quantity=document.querySelector("book-invoice #quantity"),this["book-price"]=document.querySelector("book-invoice #book-price"),this["customer-name"]=document.querySelector("book-invoice #customer-name"),this["payment-method"]=document.querySelector("book-invoice #payment-method"),this["p-date"]=document.querySelector("book-invoice #p-date"),this.currency=document.querySelector("book-invoice [com-fm='currency']"),this["download-pdf"]=document.querySelector("book-invoice #download-pdf"),this["spinner-grow"]=document.querySelector("book-invoice .spinner-grow"),this["download-text"]=document.querySelector("book-invoice .download-text"),this["form-control"]=document.querySelectorAll("book-invoice .form-control"),this["template-view-modal"]=document.querySelector("book-invoice #template-view-modal"),this["book-invoice-view"]=document.querySelector("book-invoice #book-invoice-view")}}let d={},s={},u={},m=new Date,y,b="template-1",p,t="book-invoice-data.js";let e=!1,r,v=!1;var c=()=>{if((d=new l)["form-control"].forEach(r=>{["keyup","change"].forEach(function(e){r.addEventListener(e,function(){document.querySelectorAll("[data-tm="+r.id+"]").forEach(e=>{if("p-date"==r.id)e.innerHTML=k(r.value);else{if("quantity"==r.id||"book-price"==r.id){let e=d.quantity.value,o=d["book-price"].value,t=0;"quantity"==r.id?e=r.value:o=r.value,t=0==e||""==e?o:o*e,u["book-total"].forEach(e=>{e.innerHTML=t})}e.innerHTML=r.value}})})})}),d["template-view-modal"].addEventListener("click",e=>{{u["modal-body"].innerHTML="";var o=y.cloneNode(!0);u["modal-body"].appendChild(o)}}),p=new bootstrap.Modal(d["book-invoice-view"]),window.addEventListener("click",function(e){"modal-body"==e.target.classList[0]&&p.toggle()}),d.templates.forEach(o=>o.addEventListener("click",e=>{d.templates.forEach(e=>{e.id!=o.id&&(u[o.id].classList.remove("d-none"),y=u[o.id],u[e.id].classList.add("d-none"))}),"template-2"==o.id?(document.querySelector('book-invoice [data-wrap="book-author"').classList.add("d-none"),document.querySelector('book-invoice [data-wrap="bs-name"').classList.add("d-none"),document.querySelector('book-invoice [data-wrap="store-address"').classList.add("d-none")):(document.querySelector('book-invoice [data-wrap="book-author"').classList.remove("d-none"),document.querySelector('book-invoice [data-wrap="bs-name"').classList.remove("d-none"),document.querySelector('book-invoice [data-wrap="store-address"').classList.remove("d-none"))})),d["download-pdf"].addEventListener("click",()=>{{var e=(e,o)=>{e&&(d["spinner-grow"].style.display="inline-block",d["download-text"].innerHTML="PDF Generating...",e=y.cloneNode(!0),html2pdf().set({jsPDF:{format:"a4",orientation:"portrait"},html2canvas:{letterRendering:!0,useCORS:!0,logging:!0,scrollX:0,scrollY:0},margin:[20,20,0,20],padding:0,image:{type:"jpeg",quality:.98}}).from(e).toPdf().save("Book Invoice "+server.pdfName).then(e=>{d["spinner-grow"].style.display="none",d["download-text"].innerHTML="Download"}).catch(e=>{console.log("PDF Error "+e)}))};let t=!0,r=document.getElementsByClassName("validation-message");Object.keys(r).some(function(e){var o;if("block"==r[e].style.display)return o="ErrorAdress"==r[e].id?130:80,o=r[e].getBoundingClientRect().top+window.pageYOffset-o,window.scrollTo({top:o,behavior:"smooth"}),t=!1,r[e].previousElementSibling.focus(),!0}),t?e(!0,"Template ready"):e(!1,"Template not ready")}}),e=e||!0,!v){v=!0;{let e=document.querySelectorAll(".com-wrapper");e.forEach(o=>{if(o.classList.contains("disable")){o.querySelector(".com-disable").checked=true;if(o.attributes["com-fm"])document.querySelectorAll(`[com-tm='${o.attributes["com-fm"].value}']`).forEach(e=>{e.classList.add("d-none")})}o.querySelector(".com-disable").addEventListener("click",e=>{o.classList.toggle("disable");if(o.attributes["com-fm"])document.querySelectorAll(`[com-tm='${o.attributes["com-fm"].value}']`).forEach(e=>{e.classList.toggle("d-none")})});o.querySelector(".com-close").addEventListener("click",e=>{o.classList.toggle("close");e.currentTarget.querySelector(".bi").classList.toggle("bi-plus");e.currentTarget.querySelector(".bi").classList.toggle("bi-plus-lg")});if(o.querySelector(".com-clear"))o.querySelector(".com-clear").addEventListener("click",e=>{if(o.querySelector(".com-disable").checked!=true){o.querySelectorAll('.com-body input[type="text"]').forEach(e=>{e.value=""});o.querySelectorAll(".com-body textarea").forEach(e=>{elA.value=""});o.querySelectorAll('.com-body input[type="file"]').forEach(e=>{elA.value=""})}})})}(t=document.querySelector('[data-fm="select-currency"]')).addEventListener("change",()=>{setCurrencyCall(t.selectedIndex)}),d.currency.querySelectorAll('[name="currency-type"').forEach(e=>{e.addEventListener("click",()=>{setCurrencyCall(t.selectedIndex)})}),r=[],t.querySelectorAll("option").forEach((e,o)=>{e={[e.innerHTML]:o};r[o]=e}),c=document.querySelector('[data-fm="search-currency-box"]'),n=document.querySelector('[data-fm="search-currency"]'),a="",i=[],window.addEventListener("click",function(e){e.target.attributes["data-fm"]&&("search-currency-box"==e.target.attributes["data-fm"].value||"search-currency"==e.target.attributes["data-fm"].value)||c.classList.add("d-none")}),n.addEventListener("keyup",e=>{o(n.value)}),n.addEventListener("focusin",e=>{o(n.value)}),(async e=>{dragScroller("book-invoice-template-wrapper"),u={templates:document.querySelectorAll("book-invoice .template-wrapper > .templates"),"modal-body":document.querySelector("book-invoice .modal-body"),"book-total":document.querySelectorAll('book-invoice [data-tm="book-total"]'),"receipt-number":document.querySelectorAll('book-invoice [data-tm="receipt-number"]')};for(let e in d=new l){if(document.querySelector("book-invoice p[data-error="+e+"]"))s[e]=document.querySelector("book-invoice p[data-error="+e+"]");if(document.querySelector("[data-tm="+e+"]")&&e!="template-1"&&e!="template-2")u[e]=document.querySelectorAll("book-invoice  [data-tm="+e+"]");if(e=="template-1"||e=="template-2")u[e]=document.querySelector("book-invoice .template-wrapper > [data-tm="+e+"]")}y=u[e],u["templates"].forEach(e=>{e.classList.add("d-none")}),y.classList.remove("d-none"),d[e].checked=true,d["p-date"].value=m.toISOString().substring(0,10),u["p-date"].forEach(e=>{e.innerHTML=k(m)});var o="R0"+Math.floor(Math.random()*(9999-1e3+1)+1e3);if(u["receipt-number"].forEach(e=>{e.innerHTML=o}),d["quantity"].value=0,u["quantity"].forEach(e=>{e.innerHTML=0}),d["book-price"].value=0,u["book-price"].forEach(e=>{e.innerHTML=0}),u["book-total"].forEach(e=>{e.innerHTML=0}),b=="template-2"){document.querySelector('book-invoice [data-wrap="book-author"').classList.add("d-none");document.querySelector('book-invoice [data-wrap="bs-name"').classList.add("d-none");document.querySelector('book-invoice [data-wrap="store-address"').classList.add("d-none")}})(b)}function o(e){""!=(a=e)?(0<(i=r.filter(e=>{return Object.keys(e).toString().toLowerCase().includes(a.toLowerCase())})).length&&(i.forEach((e,o,t)=>{e=`<button class="d-block" onclick="setCurrencyCall(${Object.values(e)})">${Object.keys(e)}</button>`;i[o]=e}),c.classList.remove("d-none")),i.length,0<i.length&&(c.innerHTML="",i.forEach((e,o)=>{c.innerHTML+=e}))):(c.classList.add("d-none"),i=[])}var t,r,c,n,a,i};function k(e){let o=new Date(e);return o=(o=o.toLocaleDateString("en-GB",{year:"numeric",month:"numeric",day:"numeric"})).replaceAll("/","-")}setCurrencyCall=o=>{var t,r=document.querySelector('[data-fm="select-currency"]');r.selectedIndex=o,d.currency.querySelector('[data-fm="currency-code"]').checked?u.currency.forEach(e=>{e.innerHTML=r.options[o].value}):(t=(t=(t=r.options[o].innerHTML).split("-").pop()).split(",",1).pop(),u.currency.forEach(e=>{e.innerHTML=t}))};{var n=(e,o)=>{e&&(document.querySelectorAll("book-invoice [data-dynamic]").forEach(e=>{e=e.attributes["data-dynamic"].value;addDynamicHTML(e,bookInvoiceData[e],!1)}),r=!0,c())},a=document.querySelectorAll("script");let o=!1;a.forEach(e=>{e.src.replace(/^.*[\\\/]/,"")==t&&(o=!0)}),o||((a=document.createElement("script")).src=server.jsPath+"/partialPage/"+t,a.async=!0,a.onload=()=>{n(!0,"Dynamic data loaded")},a.onerror=()=>{n(!1,"Error occurred while loading dynamic data")},document.body.appendChild(a))}};bookInvoice();