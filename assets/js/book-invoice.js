var bookInvoice=()=>{class r{constructor(){this["template-1"]=document.querySelector("book-invoice #template-1"),this["template-2"]=document.querySelector("book-invoice #template-2"),this.templates=document.querySelectorAll("book-invoice [name='templates']"),this["book-author"]=document.querySelector("book-invoice #book-author"),this["bs-name"]=document.querySelector("book-invoice #bs-name"),this["store-address"]=document.querySelector("book-invoice #store-address"),this["name-book"]=document.querySelector("book-invoice #name-book"),this.publisher=document.querySelector("book-invoice #publisher"),this.description=document.querySelector("book-invoice #description"),this.quantity=document.querySelector("book-invoice #quantity"),this["book-price"]=document.querySelector("book-invoice #book-price"),this["customer-name"]=document.querySelector("book-invoice #customer-name"),this["payment-method"]=document.querySelector("book-invoice #payment-method"),this["p-date"]=document.querySelector("book-invoice #p-date"),this.currency=document.querySelector("book-invoice [com-fm='currency']"),this["download-pdf"]=document.querySelector("book-invoice #download-pdf"),this["spinner-grow"]=document.querySelector("book-invoice .spinner-grow"),this["download-text"]=document.querySelector("book-invoice .download-text"),this["form-control"]=document.querySelectorAll("book-invoice .form-control"),this["template-view-modal"]=document.querySelector("book-invoice #template-view-modal"),this["book-invoice-view"]=document.querySelector("book-invoice #book-invoice-view")}}let l={},c={},n={},a=new Date,i,t="template-1",o,d="book-invoice-data.js";let e=!1,s=!1,u=!1;var m=()=>{l["form-control"].forEach(r=>{["keyup","change"].forEach(function(e){r.addEventListener(e,function(){document.querySelectorAll("[data-tm="+r.id+"]").forEach(e=>{if("p-date"==r.id)e.innerHTML=k(r.value);else{if("quantity"==r.id||"book-price"==r.id){let e=l.quantity.value,o=l["book-price"].value,t=0;"quantity"==r.id?e=r.value:o=r.value,t=0==e||""==e?o:o*e,n["book-total"].forEach(e=>{e.innerHTML=t})}e.innerHTML=r.value}})})})}),l["template-view-modal"].addEventListener("click",e=>{v()}),o=new bootstrap.Modal(l["book-invoice-view"]),window.addEventListener("click",function(e){"modal-body"==e.target.classList[0]&&o.toggle()}),l.templates.forEach(o=>o.addEventListener("click",e=>{l.templates.forEach(e=>{e.id!=o.id&&(n[o.id].classList.remove("d-none"),i=n[o.id],n[e.id].classList.add("d-none"))}),"template-2"==o.id?(document.querySelector('book-invoice [data-wrap="book-author"').classList.add("d-none"),document.querySelector('book-invoice [data-wrap="bs-name"').classList.add("d-none"),document.querySelector('book-invoice [data-wrap="store-address"').classList.add("d-none")):(document.querySelector('book-invoice [data-wrap="book-author"').classList.remove("d-none"),document.querySelector('book-invoice [data-wrap="bs-name"').classList.remove("d-none"),document.querySelector('book-invoice [data-wrap="store-address"').classList.remove("d-none"))})),l["download-pdf"].addEventListener("click",()=>{b((e,o)=>{e&&(l["spinner-grow"].style.display="inline-block",l["download-text"].innerHTML="PDF Generating...",e=i.cloneNode(!0),html2pdf().set({jsPDF:{format:"a4",orientation:"portrait"},html2canvas:{letterRendering:!0,useCORS:!0,logging:!0,scrollX:0,scrollY:0},margin:[20,20,0,20],padding:0,image:{type:"jpeg",quality:.98}}).from(e).toPdf().save("Book Invoice "+server.pdfName).then(e=>{p()}).catch(e=>{console.log("PDF Error "+e)}))})}),e=e||!0,s&&!u&&(u=!0,h(),f())},y=async e=>{for(var o in dragScroller("book-invoice-template-wrapper"),n={templates:document.querySelectorAll("book-invoice .template-wrapper > .templates"),"modal-body":document.querySelector("book-invoice .modal-body"),"book-total":document.querySelectorAll('book-invoice [data-tm="book-total"]'),"receipt-number":document.querySelectorAll('book-invoice [data-tm="receipt-number"]')},l=new r)document.querySelector("book-invoice p[data-error="+o+"]")&&(c[o]=document.querySelector("book-invoice p[data-error="+o+"]")),document.querySelector("[data-tm="+o+"]")&&"template-1"!=o&&"template-2"!=o&&(n[o]=document.querySelectorAll("book-invoice  [data-tm="+o+"]")),"template-1"!=o&&"template-2"!=o||(n[o]=document.querySelector("book-invoice .template-wrapper > [data-tm="+o+"]"));i=n[e],n.templates.forEach(e=>{e.classList.add("d-none")}),i.classList.remove("d-none"),l[e].checked=!0,l["p-date"].value=a.toISOString().substring(0,10),n["p-date"].forEach(e=>{e.innerHTML=k(a)});var t="R0"+Math.floor(9e3*Math.random()+1e3);n["receipt-number"].forEach(e=>{e.innerHTML=t}),l.quantity.value=0,n.quantity.forEach(e=>{e.innerHTML=0}),l["book-price"].value=0,n["book-price"].forEach(e=>{e.innerHTML=0}),n["book-total"].forEach(e=>{e.innerHTML=0}),m()},b=(y(t),e=>{let t=!0,r=document.getElementsByClassName("validation-message");Object.keys(r).some(function(e){var o;if("block"==r[e].style.display)return o="ErrorAdress"==r[e].id?130:80,o=r[e].getBoundingClientRect().top+window.pageYOffset-o,window.scrollTo({top:o,behavior:"smooth"}),t=!1,r[e].previousElementSibling.focus(),!0}),t?e(!0,"Template ready"):e(!1,"Template not ready")}),p=e=>{l["spinner-grow"].style.display="none",l["download-text"].innerHTML="Download"},v=e=>{n["modal-body"].innerHTML="";var o=i.cloneNode(!0);n["modal-body"].appendChild(o)};function k(e){let o=new Date(e);return o=(o=o.toLocaleDateString("en-GB",{year:"numeric",month:"numeric",day:"numeric"})).replaceAll("/","-")}var h=e=>{document.querySelectorAll(".com-wrapper").forEach(o=>{o.classList.contains("disable")&&(o.querySelector(".com-disable").checked=!0,o.attributes["com-fm"])&&document.querySelectorAll(`[com-tm='${o.attributes["com-fm"].value}']`).forEach(e=>{e.classList.add("d-none")}),o.querySelector(".com-disable").addEventListener("click",e=>{o.classList.toggle("disable"),o.attributes["com-fm"]&&document.querySelectorAll(`[com-tm='${o.attributes["com-fm"].value}']`).forEach(e=>{e.classList.toggle("d-none")})}),o.querySelector(".com-close").addEventListener("click",e=>{o.classList.toggle("close"),e.currentTarget.querySelector(".bi").classList.toggle("bi-plus"),e.currentTarget.querySelector(".bi").classList.toggle("bi-plus-lg")}),o.querySelector(".com-clear")&&o.querySelector(".com-clear").addEventListener("click",e=>{1!=o.querySelector(".com-disable").checked&&(o.querySelectorAll('.com-body input[type="text"]').forEach(e=>{e.value=""}),o.querySelectorAll(".com-body textarea").forEach(e=>{elA.value=""}),o.querySelectorAll('.com-body input[type="file"]').forEach(e=>{elA.value=""}))})})},f=e=>{var o=document.querySelector('[data-fm="select-currency"]'),t=(o.addEventListener("change",()=>{setCurrencyCall(o.selectedIndex)}),l.currency.querySelectorAll('[name="currency-type"').forEach(e=>{e.addEventListener("click",()=>{setCurrencyCall(o.selectedIndex)})}),[]),r=(o.querySelectorAll("option").forEach((e,o)=>{e={[e.innerHTML]:o};t[o]=e}),document.querySelector('[data-fm="search-currency-box"]')),c=document.querySelector('[data-fm="search-currency"]'),n="",a=[];function i(e){""!=(n=e)?(0<(a=t.filter(e=>{return Object.keys(e).toString().toLowerCase().includes(n.toLowerCase())})).length&&(a.forEach((e,o,t)=>{e=`<button class="d-block" onclick="setCurrencyCall(${Object.values(e)})">${Object.keys(e)}</button>`;a[o]=e}),r.classList.remove("d-none")),a.length,0<a.length&&(r.innerHTML="",a.forEach((e,o)=>{r.innerHTML+=e}))):(r.classList.add("d-none"),a=[])}window.addEventListener("click",function(e){e.target.attributes["data-fm"]&&("search-currency-box"==e.target.attributes["data-fm"].value||"search-currency"==e.target.attributes["data-fm"].value)||r.classList.add("d-none")}),c.addEventListener("keyup",e=>{i(c.value)}),c.addEventListener("focusin",e=>{i(c.value)})};setCurrencyCall=o=>{var t,r=document.querySelector('[data-fm="select-currency"]');r.selectedIndex=o,l.currency.querySelector('[data-fm="currency-code"]').checked?n.currency.forEach(e=>{e.innerHTML=r.options[o].value}):(t=(t=(t=r.options[o].innerHTML).split("-").pop()).split(",",1).pop(),n.currency.forEach(e=>{e.innerHTML=t}))};{var q=(e,o)=>{e&&(document.querySelectorAll("book-invoice [data-dynamic]").forEach(e=>{e=e.attributes["data-dynamic"].value;addDynamicHTML(e,bookInvoiceData[e],!1)}),s=!0,y(t))},S=document.querySelectorAll("script");let o=!1;S.forEach(e=>{e.src.replace(/^.*[\\\/]/,"")==d&&(o=!0)}),o||((S=document.createElement("script")).src=server.jsPath+"/partialPage/"+d,S.async=!0,S.onload=()=>{q(!0,"Dynamic data loaded")},S.onerror=()=>{q(!1,"Error occurred while loading dynamic data")},document.body.appendChild(S))}};bookInvoice();